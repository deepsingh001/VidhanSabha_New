@{
    Layout = "~/Views/Shared/_PrabhariLayout.cshtml";
}

<style>
    .chart-container {
        height: 380px; /* 👈 Graph size yaha control kare */
        width: 100%;
        position: relative;
    }

    .card {
        border-radius: 10px;
    }

    canvas {
        width: 100% !important;
        height: 100% !important;
    }
</style>



<div class="container-fluid p-3">
    @*<div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="fw-bold mb-0">System Overview</h5>
        </div>*@

    <div class="row g-2">
        <div class="col-12 col-sm-6 col-xl-3">
            <a href="/Master/VidhanSabhaRagiter" style="text-decoration: none; color: inherit;">
                <div class="stat-card d-flex align-items-center justify-content-between">

                    <div class="icon-box bg-primary bg-opacity-10 text-primary">
                        <i class="bi bi-people"></i>
                    </div>

                    <div class="text-end">
                        <h3 class="fw-bold mb-0" id="totalMembers">0</h3>
                        <p class="text-muted mb-0 small">Vidhan Sabha</p>
                    </div>

                </div>
            </a>
        </div>

        <div class="col-12 col-sm-6 col-xl-3">
            <a href="/Master/VidhanSabhaRagiter?filter=withPrabhari" style="text-decoration: none; color: inherit;">
                <div class="stat-card d-flex align-items-center justify-content-between">

                    <div class="icon-box bg-primary bg-opacity-10 text-primary">
                        <i class="bi bi-file-check"></i>
                    </div>

                    <div class="text-end">
                        <h3 class="fw-bold mb-0" id="withPrabhari">0</h3>
                        <p class="text-muted mb-0 small">With Prabhari</p>
                    </div>
                </div>
            </a>
        </div>


        <div class="col-12 col-sm-6 col-xl-3">
            <a href="/Master/VidhanSabhaRagiter?filter=withoutPrabhari" style="text-decoration: none; color: inherit;">
                <div class="stat-card d-flex align-items-center justify-content-between" style="cursor:pointer;">

                    <div class="icon-box bg-primary bg-opacity-10 text-primary">
                        <i class="bi bi-mic"></i>
                    </div>

                    <div class="text-end">
                        <h3 class="fw-bold mb-0" id="withoutPrabhari">0</h3>
                        <p class="text-muted mb-0 small">Without Prabhari</p>
                    </div>

                </div>
            </a>
        </div>


        <div class="col-12 col-sm-6 col-xl-3">
            <a href="/Master/addStateCount" style="text-decoration: none; color: inherit;">
                <div class="stat-card d-flex align-items-center justify-content-between" style="cursor:pointer;">

                    <div class="icon-box bg-primary bg-opacity-10 text-primary">
                        <i class="bi bi-bank fs-5 text-primary"></i>
                    </div>

                    <div class="text-end">
                        <h3 class="fw-bold mb-0" id="TotalUsedStates">0</h3>
                        <p class="text-muted mb-0 small">Total States</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-12 col-sm-6 col-xl-3">
            <a href="/Master/addDistrictCount" style="text-decoration: none; color: inherit;">
                <div class="stat-card d-flex align-items-center justify-content-between" style="cursor:pointer;">

                    <div class="icon-box bg-primary bg-opacity-10 text-primary">
                        <i class="bi bi-geo-alt fs-5 "></i>
                    </div>

                    <div class="text-end">
                        <h3 class="fw-bold mb-0" id="TotalUsedDistrict">0</h3>
                        <p class="text-muted mb-0 small">Total District</p>
                    </div>
                </div>
            </a>
        </div>




        <div class="row g-2 mt-2">

            <!-- State wise Vidhan Sabha -->
            <div class="col-md-6 stateChartDiv">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h6 class="fw-bold mb-3">State Wise Vidhan Sabha</h6>
                        <div class="chart-container">
                            <canvas id="stateChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- District wise Vidhan Sabha -->
            <div class="col-md-6 districtChartdiv">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h6 class="fw-bold mb-3">District Wise Vidhan Sabha</h6>
                        <div class="chart-container">
                            <canvas id="districtChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

</div>



@*<script src="~/Scripts/jquery-3.7.0.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const pieColors = [
        '#ff6384',
        '#ff9f40',
        '#ffcd56',
        '#4bc0c0',
        '#36a2eb',
        '#9966ff',
        '#c9cbcf'
    ];
</script>

<script>
    let charts = {};

    function loadPieChart(apiUrl, canvasId, chartTitle) {

        $.get(apiUrl, function (res) {

            let labels = [];
            let values = [];
            let colors = [];

            if (res.data && res.data.length > 0) {
                labels = res.data.map(x => x.Key);
                values = res.data.map(x => x.Value);
                colors = pieColors;
            } else {
                // 👇 No Data case
                labels = ['No Data'];
                values = [1];
                colors = ['#e0e0e0']; // Grey color
            }

            // Destroy old chart if exists
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(document.getElementById(canvasId), {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            //display: true,
                            text: chartTitle
                        }
                    }
                }
            });

        });
    }

    $(document).ready(function () {

        // ✅ State Chart
        loadPieChart(
            '/api/Admin/GetStateWiseVidhanSabhaChart',
            'stateChart',
            'State Wise Vidhan Sabha'
        );

        // ✅ District Chart
        loadPieChart(
            '/api/Admin/GetDistrictWiseVidhanSabhaChart',
            'districtChart',
            'District Wise Vidhan Sabha'
        );

    });
</script>*@





@*<script>
    $(document).ready(function () {
        function loadDashboardCounts() {
            $.ajax({
                url: '/api/Admin/GetDashboardCounts',
                type: 'GET',
                success: function (response) {
                    // Nested data path fix
                    if (response.success && response.data.success) {
                        var counts = response.data.data;

                        $('#totalMembers').text(counts.TotalVidhanSabhaCount);
                        $('#withPrabhari').text(counts.TotalVidhanSabhaWithPrabhari);
                        $('#withoutPrabhari').text(counts.TotalVidhanSabhaWithoutPrabhari);
                        $('#TotalUsedStates').text(counts.TotalUsedStates);
                        $('#TotalUsedDistrict').text(counts.TotalUsedDistrict);

                    } else {
                        console.error('Failed to fetch dashboard counts');
                    }
                },
                error: function (err) {
                    console.error('Error:', err);
                }
            });
        }

        loadDashboardCounts();
    });
</script>*@

